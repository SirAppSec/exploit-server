#!/usr/bin/env bash

IP="20.79.152.143"
user="ubuntu"
echo "Begin updating ${IP}"

#set permissions
ssh ${user}@${IP} 'sudo chmod -R 0777 /var/www'
ssh ${user}@${IP} 'sudo chmod -R 0777 /etc/nginx'
rsync -v --exclude '.rsyncignore' nginx/nginx.conf ${user}@${IP}:/etc/nginx/sites-enabled/default
rsync -aPv --exclude '.rsyncignore' www/ ${user}@${IP}:/var/www

#reset permissions
ssh ${user}@${IP} 'sudo chmod -R 0755 /var/www'
ssh ${user}@${IP} 'sudo chmod -R 0744 /etc/nginx'
ssh ${user}@${IP} 'sudo systemctl restart nginx'